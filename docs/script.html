<body>
<pre id="script"></pre>
<script>
	const PHI     = 1.61803398875;
    const bf      = 90;
    const b       = bf * Math.pow(PHI, -7) / 2;
    const f       = (n, i) => bf * Math.pow(2, i/n);
	
    let audio     = null;
    let o_1_left  = null;
    let o_1_right = null;
    let o_2_left  = null;
    let o_2_right = null;
	let g         = null;
	let id        = null;

	const s1 = [ 
		f(12,  0),
		f(12,  0),
		// f(12,  1),
		// f(12,  2),
		// f(12,  3),
		// f(12,  4),
		// f(12,  5),
		// f(12,  6),
		// f(12,  7),
	];

	const s2 = [
		f(12,  1 + 12),
		f(12,  2 + 12),
		f(12,  3 + 12),
		f(12,  4 + 12),
		f(12,  5 + 12),
		f(12,  6 + 12),
		f(12,  7 + 12),
		f(12,  8 + 12),
		f(12,  9 + 12),
	];
	
	let i1 = 0;
	let i2 = 0;

    const loop = _ => {
       	o_1_left .frequency.setTargetAtTime(s1[i1] - b, audio.currentTime, .05);
		o_1_right.frequency.setTargetAtTime(s1[i1] + b, audio.currentTime, .05); 
		if (i1 % s2.length === 0) {
	       	o_2_left .frequency.setTargetAtTime(s2[i2] - b, audio.currentTime, .05);
			o_2_right.frequency.setTargetAtTime(s2[i2] + b, audio.currentTime, .05); 
			i2 = (i2 + 1) % s2.length;
		}
		i1 = (i1 + 1) % s1.length;
    };
    
    document.body.addEventListener("click", _ => {
		if (audio === null) {
	        audio = new (window.AudioContext || window.webkitAudioContext)();
		}
		if (id === null) {
			i1 = 0;
			i2 = 0;
	        g = audio.createGain();
	        g.gain.value = 0;
	        g.connect(audio.destination);
	        g.gain.setTargetAtTime(.5, audio.currentTime, .05);

	        const g1 = audio.createGain();
	        const g2 = audio.createGain();
	        g1.gain.value = 1;
	        g2.gain.value = 1;
	        g1.connect(g);
	        g2.connect(g);
	    	const m1 = audio.createChannelMerger();
	    	const m2 = audio.createChannelMerger();
	    	m1.connect(g1);
	    	m2.connect(g2);
	    	o_1_left  = audio.createOscillator();
	    	o_1_right = audio.createOscillator();
	    	o_2_left  = audio.createOscillator();
	    	o_2_right = audio.createOscillator();
	        o_1_left .connect(m1, 0, 0);
	        o_1_right.connect(m1, 0, 1);
	        o_2_left .connect(m2, 0, 0);
	        o_2_right.connect(m2, 0, 1);
	        o_1_left .frequency.value = bf;
	        o_1_right.frequency.value = bf;
	        o_2_left .frequency.value = bf;
	        o_2_right.frequency.value = bf;
	        o_1_left .start();
	        o_1_right.start();
	        o_2_left .start();
	        o_2_right.start();
			loop();
	        id = setInterval(loop, 3000);
		} else {
			let old_g = g;
			g = null;
			old_g.gain.setTargetAtTime(0, audio.currentTime, .05);
			setTimeout(_ => old_g.disconnect(), 1000);
			clearInterval(id);
			id = null;
		}

    });
    document.getElementById("script").append(document.body.innerHTML);
</script>
</body>